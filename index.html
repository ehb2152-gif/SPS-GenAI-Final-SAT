<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI SAT Test Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>.spinner {border: 4px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top: 4px solid #ffffff; width: 24px; height: 24px; animation: spin 1s linear infinite;} @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } .whitespace-pre-wrap { white-space: pre-wrap; }</style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans p-8 flex justify-center min-h-screen">
    <main class="w-full max-w-2xl">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-white">AI SAT Test Generator</h1>
        </header>
        <form id="generate-form" class="bg-gray-800 p-6 rounded-lg shadow-xl mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><label class="block text-sm">Subject</label><select name="subject" class="w-full bg-gray-700 rounded p-2"><option value="math">Math</option><option value="verbal">Verbal</option></select></div>
                <div><label class="block text-sm">Difficulty</label><select name="difficulty" class="w-full bg-gray-700 rounded p-2"><option value="easy">Easy</option><option value="medium">Medium</option><option value="hard">Hard</option></select></div>
                <div class="md:col-span-2"><label class="block text-sm">Section</label><input type="text" name="section" value="algebra" class="w-full bg-gray-700 rounded p-2"></div>
            </div>
            <div class="mt-4 flex items-center"><input id="include_solution" name="include_solution" type="checkbox" class="h-4 w-4 rounded bg-gray-700"><label class="ml-2 block text-sm">Include solution immediately</label></div>
            <div class="mt-6"><button type="submit" id="generate-btn" class="w-full bg-blue-600 hover:bg-blue-700 font-bold py-3 px-4 rounded transition"><span id="btn-text">Generate Question</span><div id="spinner" class="spinner hidden"></div></button></div>
        </form>
        <div id="error-box" class="hidden bg-red-800 text-red-100 p-4 rounded mb-6"><p id="error-message"></p></div>
        <div id="question-card" class="hidden bg-gray-800 rounded shadow-xl p-6 mb-6">
            <h2 class="text-xl font-semibold text-blue-300 mb-3">Generated Question</h2>
            <p id="question-text" class="text-gray-200 text-lg whitespace-pre-wrap"></p>
            <div class="mt-4 flex gap-3"><button id="reveal-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Reveal Solution</button></div>
            <p id="save-message" class="text-sm mt-2 hidden"></p>
        </div>
        <div id="solution-card" class="hidden bg-gray-800 rounded shadow-xl p-6 border-t-4 border-green-500"><h2 class="text-xl font-semibold text-green-300 mb-3">Solution</h2><p id="solution-text" class="text-gray-200 text-lg whitespace-pre-wrap"></p></div>
    </main>
    <script>
        let currentData = null;
        const form = document.getElementById('generate-form');
        const generateBtn = document.getElementById('generate-btn');
        const btnText = document.getElementById('btn-text');
        const spinner = document.getElementById('spinner');
        const errorBox = document.getElementById('error-box');
        const questionCard = document.getElementById('question-card');
        const solutionCard = document.getElementById('solution-card');
        const revealBtn = document.getElementById('reveal-btn');
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            btnText.innerText = "Generating..."; generateBtn.disabled = true; spinner.classList.remove('hidden');
            errorBox.classList.add('hidden'); questionCard.classList.add('hidden'); solutionCard.classList.add('hidden');
            const formData = new FormData(form);
            const jsonData = Object.fromEntries(formData.entries());
            jsonData.include_solution = document.getElementById('include_solution').checked;
            try {
                const response = await fetch('/api/generate', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(jsonData) });
                if (!response.ok) throw new Error(`Server error: ${response.status}`);
                const data = await response.json();
                currentData = { ...data, ...jsonData };
                document.getElementById('question-text').innerText = data.question;
                document.getElementById('solution-text').innerText = data.solution || "Solution not parsed.";
                questionCard.classList.remove('hidden');
                if (jsonData.include_solution) { solutionCard.classList.remove('hidden'); revealBtn.classList.add('hidden'); } 
                else { revealBtn.classList.remove('hidden'); }
            } catch (err) { document.getElementById('error-message').innerText = err.message; errorBox.classList.remove('hidden'); } 
            finally { btnText.innerText = "Generate Question"; generateBtn.disabled = false; spinner.classList.add('hidden'); }
        });
        revealBtn.addEventListener('click', () => { solutionCard.classList.remove('hidden'); revealBtn.classList.add('hidden'); });
        document.getElementById('save-btn').addEventListener('click', async () => {
            if (!currentData) return;
            const msg = document.getElementById('save-message');
            msg.innerText = "Saving..."; msg.classList.remove('hidden', 'text-green-500', 'text-red-600');
            try { await fetch('/api/save', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(currentData) }); msg.innerText = "âœ… Saved!"; msg.classList.add('text-green-500'); } 
            catch (err) { msg.innerText = "Error saving."; msg.classList.add('text-red-600'); }
        });
    </script>
</body>
</html>